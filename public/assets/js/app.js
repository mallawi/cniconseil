/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.l = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// identity function for calling harmory imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };

/******/ 	// define getter function for harmory exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		Object.defineProperty(exports, name, {
/******/ 			configurable: false,
/******/ 			enumerable: true,
/******/ 			get: getter
/******/ 		});
/******/ 	};

/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};

/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports) {

eval("(function() {\n    \"use strict\";\n\n    // constructor function for XMLHttpRequest that return a promise\n    function XHRequest(progress) {\n\n        var pCb = progress;\n\n        function ajaxReq(method, url, data) {\n            var promise = new Promise( function (resolve, reject) {\n                var xhr = new XMLHttpRequest();\n\n                if (pCb) {\n                    xhr.addEventListener(\"progress\", pCb.progress);\n                    xhr.addEventListener(\"load\", pCb.load);\n                }\n\n                if (method === \"GET\") {\n                    xhr.responseType = \"document\";\n                }\n                    \n                xhr.open(method, url);\n\n                if (data)\n                    xhr.send(data);  \n                else\n                    xhr.send();\n\n                xhr.onreadystatechange = function() {\n                    if (this.readyState === 4) {\n                        if (this.status === 200) {\n                            resolve(this.response);\n                        } else {\n                            reject(this.status);\n                        }\n                    } else {\n                        \n                    }\n                }\n            });\n\n            return promise;\n        }\n\n        return {\n            get: function(url) {\n                return ajaxReq(\"GET\", url);\n            },\n            post: function(url, data) {\n                if (data) { return ajaxReq(\"POST\", url, data); }\n                return ajaxReq(\"POST\", url);\n            }\n        }\n\n    }\n\n    var formsHandler;\n\n    function FormsHandler() { // constructor function for forms handling\n\n        return {\n            init: function() {\n                var formsItems = document.getElementsByClassName(\"forms--item\");\n\n                if (formsItems) {\n                    for (var i = 0; i < formsItems.length; i++) {\n                        formsItems[i].addEventListener(\"click\", function(ev) {\n                            ev.preventDefault();\n                            ev.stopPropagation();\n                            console.log(this);\n                            formsGetHandler(this);\n                        });\n                    }\n                } else if (document.forms) {\n                    this.handle.listen();\n                } else {\n                    return;\n                }\n            },\n            makeChanges: function(data) {\n                var requestedData = data,\n                    formHolder = document.getElementById(\"form--container\"),\n                    requestedForm = requestedData.getElementById(\"form--wrap\");\n\n                if (formHolder.classList.contains(\"form--shown\")) { // replace the form if other shown\n                    // this.handle.replace(formHolder, requestedForm);\n                    var oldForm = document.getElementById(\"form--wrap\");\n                    formHolder.replaceChild(requestedForm, oldForm);\n                    this.formRef.current.classList.add(\"forms--item-current\");\n                    this.formRef.old.classList.remove(\"forms--item-current\");\n                    this.formRef.old = this.formRef.current;\n\n                    this.handle.listen();\n                    console.log(\"replaced\");\n                } else { // if no form shown add\n                    formHolder.classList.add(\"form--shown\");\n                    this.formRef.current.classList.add(\"forms--item-current\");\n                    formHolder.appendChild(requestedForm);\n                    this.formRef.old = this.formRef.current;\n            \n                    this.handle.listen();\n\n                    console.log(\"added\");\n                }\n            },\n            formRef: { // forms references, current for requested, and old for the last\n                old: null,\n                current: null\n            },\n            handle: { // listening for form submition and handling it\n                listen: function() {\n                    var formEl =  document.forms[0];\n\n                    console.log(formEl);\n                    \n                    formEl.addEventListener(\"submit\", function(ev) {\n                        ev.preventDefault();\n\n                        formsPostHandler(formEl); // sending the form to be posted to server\n                        return false;\n                    });\n\n                    formEl.addEventListener(\"reset\", function(ev) {\n                        formsHandler.handle.remove();\n                        return;\n                    });\n                },\n                remove: function() {\n                    var oldForm = document.getElementById(\"form--wrap\"),\n                        formHolder = document.getElementById(\"form--container\");\n\n                    formHolder.removeChild(oldForm);\n                    formHolder.classList.remove(\"form--shown\");\n                    formsHandler.formRef.old.classList.remove(\"forms--item-current\");\n                }\n            }\n        }\n    }\n\n\n    function formsGetHandler(formItem) {\n        var currentFormRef = formItem;\n\n        var responseHandler = {\n            success: function(data) {\n                formsHandler.makeChanges(data);\n            },\n            failed: function(status) {\n                console.log(status);\n            }\n        },\n        progressCb = {\n            progress: function(ev) {\n                currentFormRef.classList.add(\"form--item-progress\");\n            },\n            load: function(ev) {\n                currentFormRef.classList.remove(\"form--item-progress\");\n            }\n        }\n\n        function getForms() {\n            formsHandler.formRef.current = formItem;\n\n            var typeAttr = formItem.getAttribute(\"data-type\");\n\n            if (formItem.classList.contains(\"forms--item-current\")) {\n                 if (formsHandler.formRef.old && formItem === formsHandler.formRef.old) {\n                    formsHandler.handle.remove();\n                    return;\n                }\n            }\n\n            var url = \"/form/\" + typeAttr,\n                xhrequest = new XHRequest(progressCb);\n\n            xhrequest.get(url).then(responseHandler.success).catch(responseHandler.failed);\n        }\n\n        if (formItem) {\n            getForms();\n        }\n    }\n\n\n    function formsPostHandler(formEl) {\n        var formData = new FormData(formEl);\n\n        for (var eItem = 0; eItem < formEl.elements.length; eItem++) {\n            if (formEl.elements[eItem].tagName.toUpperCase() === \"BUTTON\") { continue; }\n            if (!formEl.elements[eItem].required && !formEl.elements[eItem].value) {\n                formData.set(formEl.elements[eItem].name, 11111);\n            }\n        }\n        \n        console.log(formEl.id);\n\n        // switch(formEl.id) {\n        //     case \"\":\n        //     break;\n        // }\n        return;\n\n        var formAction = formEl.getAttribute(\"data-action\");\n\n        var progressCb = {\n            progress: function(ev) {\n\n            },\n            load: function(ev) {\n                // console.log(ev);\n            }\n        },\n        responseHandler = {\n            success: function(data) {\n                formsHandler.handle.remove();\n\n                var confirmMsg = document.getElementById(\"form--confirmation-message\");\n                confirmMsg.classList.add(\"message--shown\");\n\n                var msgTimeout = setTimeout(function() {\n                    confirmMsg.classList.remove(\"message--shown\");\n                    clearTimeout(msgTimeout);\n                }, 5000);\n\n                console.log(data);\n            },\n            failed: function(status) {\n                console.log(status);\n            }\n        }\n        \n        var xhrequest = new XHRequest(progressCb);\n        xhrequest.post(formAction, formData).then(responseHandler.success).catch(responseHandler.failed);\n    }\n\n\n    // function handler for handling sliders\n    function Slider(cls) {\n        var cls = cls,\n            itemInterval = null,\n             self = this;\n\n        this.currentIdx = null;\n\n        this.stopInterval = function() {\n            clearInterval(this.itemInterval);\n        }\n\n        // making changes to the slider\n        this.changeSliderItem = function(current, item, cls) {\n            current.classList.remove(cls);\n            item.classList.add(cls);\n            this.currentIdx = item;\n        }\n\n        this.intervalSliderItem = function(items, currentItem) {\n            self.currentIdx = currentItem;\n            this.itemInterval = setInterval(function() {\n                if (self.currentIdx) {\n                    for (var idx = 0; idx < items.length; idx++) {\n                        if (self.currentIdx === items[idx]) {\n                            var item = idx - 1;\n                            if (idx - 1 < 0) {\n                                var item = items.length - 1;\n                            }\n                            self.changeSliderItem(self.currentIdx, items[item], cls);\n                            break;\n                        }\n                    }\n                }\n            }, 3000);\n        }\n    }\n\n\n    function slideAnnonceMain() {\n        var prevBtn,\n            nextBtn,\n            sliderBtns = document.getElementsByClassName(\"slider--btn\"),\n            sliderItems = document.getElementsByClassName(\"slider--item\"),\n            sliderHandler = new Slider(\"slider--item-current\");\n\n        if (!sliderBtns.length || !sliderItems.length) { return; }\n\n        // handler for btns and slider items\n        var btnsAction = {\n            previous: function(btn) {\n                if (nextBtn && nextBtn.disabled === true) {\n                    nextBtn.disabled = false;\n                }\n\n                for (var idx = 0; idx < sliderItems.length; idx++) {\n                    if (sliderItems[idx].classList.contains(\"slider--item-current\")) {\n                        if (idx + 1 === sliderItems.length ) {\n                            btn.disabled = true;\n                            return;\n                        }\n\n                        var item = idx + 1;\n\n                        sliderHandler.changeSliderItem(sliderItems[idx], sliderItems[item], \"slider--item-current\");\n                        break;\n                    }\n                }\n            },\n            next: function(btn) {\n                if (prevBtn && prevBtn.disabled === true) {\n                    prevBtn.disabled = false;\n                }\n\n                for (var idx = 0; idx < sliderItems.length; idx++) {\n                    if (sliderItems[idx].classList.contains(\"slider--item-current\")) {\n                        if (idx - 1 < 0 ) {\n                            btn.disabled = true;\n                            return;\n                        } \n\n                        var item = idx - 1;\n\n                        sliderHandler.changeSliderItem(sliderItems[idx], sliderItems[item], \"slider--item-current\");\n                        break;\n                    }\n                }\n            }\n        }\n\n        // event listener handler, determining the btn and calling the right action\n        function btnsHandler(ev) {\n            ev.preventDefault();\n            ev.stopPropagation();\n\n            sliderHandler.stopInterval();\n\n            switch(this.name) {\n                case \"previous--btn\":\n                    btnsAction.previous(this);\n                    prevBtn = this;\n                    break;\n                case \"next--btn\":\n                    btnsAction.next(this);\n                    nextBtn = this;\n                    break;\n            }\n\n        }\n\n        // loops to add event listeners to btns and iterating over slider items\n        for (var i = 0; i < sliderBtns.length; i++) {\n            sliderBtns[i].addEventListener(\"click\", btnsHandler);\n        }\n\n        for (var idx = 0; idx < sliderItems.length; idx++) {\n            if (idx === sliderItems.length - 1) {\n                sliderItems[idx].classList.add(\"slider--item-current\");\n                sliderHandler.intervalSliderItem(sliderItems, sliderItems[idx]);\n                break;\n            }\n        }\n        \n    }\n\n\n    function slideAnnoncesFig() {\n        var sliderHandler,\n            annoncesCellRef = {},\n            annoncesCell = document.getElementsByClassName(\"annonces--grid-cell\");\n\n        if (!annoncesCell) return;\n\n        for (var i = 0; i < annoncesCell.length; i++) {\n            var cellChildren = annoncesCell[i].children,\n                cell = annoncesCell[i];\n            annoncesCellRef[cell] = [];\n\n            sliderHandler = new Slider(\"annonces--fig-current\");\n\n            for (var ix = 0; ix < cellChildren.length; ix++) {\n\n                if (cellChildren[ix].tagName === \"FIGURE\") {\n                    annoncesCellRef[cell][ix] = cellChildren.item(ix);\n\n                    if (ix === 0) {\n                        cellChildren.item(ix).classList.add(\"annonces--fig-current\");\n                        sliderHandler.intervalSliderItem(annoncesCellRef[cell], cellChildren.item(ix));\n                    }\n                }\n            }\n            console.log(sliderHandler);\n        }\n    }\n\n    function annonceGalleryHandler() {\n        var gallery = document.getElementsByClassName(\"annonce--gallery-wrap\")[0],\n            cellItem = document.getElementsByClassName(\"annonce--item-cell\")[0],\n            cellItems = document.getElementsByClassName(\"annonce--items-cell\");\n\n        if (!gallery) return;\n\n        for (var i = 0; i < cellItems.length; i++) {\n            cellItems[i].addEventListener(\"click\", function(ev) {\n                ev.preventDefault();\n                var fig = this.innerHTML;\n                this.innerHTML = cellItem.innerHTML;\n                cellItem.innerHTML = fig;\n            });\n        }\n    } \n\n\n    function init() {\n        console.log(\"document ready!\");\n    }\n\n\n    function navHandler() {\n        var hamBtn = document.getElementById(\"ham--button\"),\n            nav = document.getElementById(\"main--nav\");\n\n        hamBtn.addEventListener(\"click\", function(ev) {\n            ev.preventDefault();\n\n           if (!nav.classList.contains(\"nav--shown\")) {\n                nav.classList.add(\"nav--shown\");\n           } else {\n               nav.classList.remove(\"nav--shown\");\n           }\n        });\n    } \n\n    document.onreadystatechange = function() {\n        if (document.readyState === \"complete\") {\n            init();\n            navHandler();\n            formsHandler = new FormsHandler();\n            formsHandler.init();          \n            slideAnnonceMain();\n            slideAnnoncesFig();\n            annonceGalleryHandler();\n        }\n    }\n\n}());\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9yZXNvdXJjZXMvYXNzZXRzL2pzL2FwcC5qcz84YjY3Il0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBYTUxIdHRwUmVxdWVzdCB0aGF0IHJldHVybiBhIHByb21pc2VcbiAgICBmdW5jdGlvbiBYSFJlcXVlc3QocHJvZ3Jlc3MpIHtcblxuICAgICAgICB2YXIgcENiID0gcHJvZ3Jlc3M7XG5cbiAgICAgICAgZnVuY3Rpb24gYWpheFJlcShtZXRob2QsIHVybCwgZGF0YSkge1xuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICAgICAgICAgIGlmIChwQ2IpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLCBwQ2IucHJvZ3Jlc3MpO1xuICAgICAgICAgICAgICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgcENiLmxvYWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChtZXRob2QgPT09IFwiR0VUXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IFwiZG9jdW1lbnRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsKTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhKVxuICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZChkYXRhKTsgIFxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoKTtcblxuICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRoaXMucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QodGhpcy5zdGF0dXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYWpheFJlcShcIkdFVFwiLCB1cmwpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvc3Q6IGZ1bmN0aW9uKHVybCwgZGF0YSkge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhKSB7IHJldHVybiBhamF4UmVxKFwiUE9TVFwiLCB1cmwsIGRhdGEpOyB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFqYXhSZXEoXCJQT1NUXCIsIHVybCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHZhciBmb3Jtc0hhbmRsZXI7XG5cbiAgICBmdW5jdGlvbiBGb3Jtc0hhbmRsZXIoKSB7IC8vIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBmb3JtcyBoYW5kbGluZ1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybXNJdGVtcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJmb3Jtcy0taXRlbVwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb3Jtc0l0ZW1zKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9ybXNJdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9ybXNJdGVtc1tpXS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zR2V0SGFuZGxlcih0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5mb3Jtcykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZS5saXN0ZW4oKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ha2VDaGFuZ2VzOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3RlZERhdGEgPSBkYXRhLFxuICAgICAgICAgICAgICAgICAgICBmb3JtSG9sZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmb3JtLS1jb250YWluZXJcIiksXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RlZEZvcm0gPSByZXF1ZXN0ZWREYXRhLmdldEVsZW1lbnRCeUlkKFwiZm9ybS0td3JhcFwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChmb3JtSG9sZGVyLmNsYXNzTGlzdC5jb250YWlucyhcImZvcm0tLXNob3duXCIpKSB7IC8vIHJlcGxhY2UgdGhlIGZvcm0gaWYgb3RoZXIgc2hvd25cbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5oYW5kbGUucmVwbGFjZShmb3JtSG9sZGVyLCByZXF1ZXN0ZWRGb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZEZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImZvcm0tLXdyYXBcIik7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1Ib2xkZXIucmVwbGFjZUNoaWxkKHJlcXVlc3RlZEZvcm0sIG9sZEZvcm0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1SZWYuY3VycmVudC5jbGFzc0xpc3QuYWRkKFwiZm9ybXMtLWl0ZW0tY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtUmVmLm9sZC5jbGFzc0xpc3QucmVtb3ZlKFwiZm9ybXMtLWl0ZW0tY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtUmVmLm9sZCA9IHRoaXMuZm9ybVJlZi5jdXJyZW50O1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlLmxpc3RlbigpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlcGxhY2VkXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIGlmIG5vIGZvcm0gc2hvd24gYWRkXG4gICAgICAgICAgICAgICAgICAgIGZvcm1Ib2xkZXIuY2xhc3NMaXN0LmFkZChcImZvcm0tLXNob3duXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm1SZWYuY3VycmVudC5jbGFzc0xpc3QuYWRkKFwiZm9ybXMtLWl0ZW0tY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybUhvbGRlci5hcHBlbmRDaGlsZChyZXF1ZXN0ZWRGb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtUmVmLm9sZCA9IHRoaXMuZm9ybVJlZi5jdXJyZW50O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlLmxpc3RlbigpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiYWRkZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZvcm1SZWY6IHsgLy8gZm9ybXMgcmVmZXJlbmNlcywgY3VycmVudCBmb3IgcmVxdWVzdGVkLCBhbmQgb2xkIGZvciB0aGUgbGFzdFxuICAgICAgICAgICAgICAgIG9sZDogbnVsbCxcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBudWxsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGFuZGxlOiB7IC8vIGxpc3RlbmluZyBmb3IgZm9ybSBzdWJtaXRpb24gYW5kIGhhbmRsaW5nIGl0XG4gICAgICAgICAgICAgICAgbGlzdGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvcm1FbCA9ICBkb2N1bWVudC5mb3Jtc1swXTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhmb3JtRWwpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgZm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zUG9zdEhhbmRsZXIoZm9ybUVsKTsgLy8gc2VuZGluZyB0aGUgZm9ybSB0byBiZSBwb3N0ZWQgdG8gc2VydmVyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1zSGFuZGxlci5oYW5kbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZEZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImZvcm0tLXdyYXBcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtSG9sZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJmb3JtLS1jb250YWluZXJcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9ybUhvbGRlci5yZW1vdmVDaGlsZChvbGRGb3JtKTtcbiAgICAgICAgICAgICAgICAgICAgZm9ybUhvbGRlci5jbGFzc0xpc3QucmVtb3ZlKFwiZm9ybS0tc2hvd25cIik7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1zSGFuZGxlci5mb3JtUmVmLm9sZC5jbGFzc0xpc3QucmVtb3ZlKFwiZm9ybXMtLWl0ZW0tY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIGZvcm1zR2V0SGFuZGxlcihmb3JtSXRlbSkge1xuICAgICAgICB2YXIgY3VycmVudEZvcm1SZWYgPSBmb3JtSXRlbTtcblxuICAgICAgICB2YXIgcmVzcG9uc2VIYW5kbGVyID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGZvcm1zSGFuZGxlci5tYWtlQ2hhbmdlcyhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsZWQ6IGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHByb2dyZXNzQ2IgPSB7XG4gICAgICAgICAgICBwcm9ncmVzczogZnVuY3Rpb24oZXYpIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50Rm9ybVJlZi5jbGFzc0xpc3QuYWRkKFwiZm9ybS0taXRlbS1wcm9ncmVzc1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2FkOiBmdW5jdGlvbihldikge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRGb3JtUmVmLmNsYXNzTGlzdC5yZW1vdmUoXCJmb3JtLS1pdGVtLXByb2dyZXNzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Rm9ybXMoKSB7XG4gICAgICAgICAgICBmb3Jtc0hhbmRsZXIuZm9ybVJlZi5jdXJyZW50ID0gZm9ybUl0ZW07XG5cbiAgICAgICAgICAgIHZhciB0eXBlQXR0ciA9IGZvcm1JdGVtLmdldEF0dHJpYnV0ZShcImRhdGEtdHlwZVwiKTtcblxuICAgICAgICAgICAgaWYgKGZvcm1JdGVtLmNsYXNzTGlzdC5jb250YWlucyhcImZvcm1zLS1pdGVtLWN1cnJlbnRcIikpIHtcbiAgICAgICAgICAgICAgICAgaWYgKGZvcm1zSGFuZGxlci5mb3JtUmVmLm9sZCAmJiBmb3JtSXRlbSA9PT0gZm9ybXNIYW5kbGVyLmZvcm1SZWYub2xkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1zSGFuZGxlci5oYW5kbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBcIi9mb3JtL1wiICsgdHlwZUF0dHIsXG4gICAgICAgICAgICAgICAgeGhyZXF1ZXN0ID0gbmV3IFhIUmVxdWVzdChwcm9ncmVzc0NiKTtcblxuICAgICAgICAgICAgeGhyZXF1ZXN0LmdldCh1cmwpLnRoZW4ocmVzcG9uc2VIYW5kbGVyLnN1Y2Nlc3MpLmNhdGNoKHJlc3BvbnNlSGFuZGxlci5mYWlsZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGZvcm1JdGVtKSB7XG4gICAgICAgICAgICBnZXRGb3JtcygpO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBmb3Jtc1Bvc3RIYW5kbGVyKGZvcm1FbCkge1xuICAgICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybUVsKTtcblxuICAgICAgICBmb3IgKHZhciBlSXRlbSA9IDA7IGVJdGVtIDwgZm9ybUVsLmVsZW1lbnRzLmxlbmd0aDsgZUl0ZW0rKykge1xuICAgICAgICAgICAgaWYgKGZvcm1FbC5lbGVtZW50c1tlSXRlbV0udGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSBcIkJVVFRPTlwiKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICBpZiAoIWZvcm1FbC5lbGVtZW50c1tlSXRlbV0ucmVxdWlyZWQgJiYgIWZvcm1FbC5lbGVtZW50c1tlSXRlbV0udmFsdWUpIHtcbiAgICAgICAgICAgICAgICBmb3JtRGF0YS5zZXQoZm9ybUVsLmVsZW1lbnRzW2VJdGVtXS5uYW1lLCAxMTExMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGZvcm1FbC5pZCk7XG5cbiAgICAgICAgLy8gc3dpdGNoKGZvcm1FbC5pZCkge1xuICAgICAgICAvLyAgICAgY2FzZSBcIlwiOlxuICAgICAgICAvLyAgICAgYnJlYWs7XG4gICAgICAgIC8vIH1cbiAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHZhciBmb3JtQWN0aW9uID0gZm9ybUVsLmdldEF0dHJpYnV0ZShcImRhdGEtYWN0aW9uXCIpO1xuXG4gICAgICAgIHZhciBwcm9ncmVzc0NiID0ge1xuICAgICAgICAgICAgcHJvZ3Jlc3M6IGZ1bmN0aW9uKGV2KSB7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2FkOiBmdW5jdGlvbihldikge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzcG9uc2VIYW5kbGVyID0ge1xuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIGZvcm1zSGFuZGxlci5oYW5kbGUucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgY29uZmlybU1zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZm9ybS0tY29uZmlybWF0aW9uLW1lc3NhZ2VcIik7XG4gICAgICAgICAgICAgICAgY29uZmlybU1zZy5jbGFzc0xpc3QuYWRkKFwibWVzc2FnZS0tc2hvd25cIik7XG5cbiAgICAgICAgICAgICAgICB2YXIgbXNnVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1Nc2cuY2xhc3NMaXN0LnJlbW92ZShcIm1lc3NhZ2UtLXNob3duXCIpO1xuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobXNnVGltZW91dCk7XG4gICAgICAgICAgICAgICAgfSwgNTAwMCk7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsZWQ6IGZ1bmN0aW9uKHN0YXR1cykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHZhciB4aHJlcXVlc3QgPSBuZXcgWEhSZXF1ZXN0KHByb2dyZXNzQ2IpO1xuICAgICAgICB4aHJlcXVlc3QucG9zdChmb3JtQWN0aW9uLCBmb3JtRGF0YSkudGhlbihyZXNwb25zZUhhbmRsZXIuc3VjY2VzcykuY2F0Y2gocmVzcG9uc2VIYW5kbGVyLmZhaWxlZCk7XG4gICAgfVxuXG5cbiAgICAvLyBmdW5jdGlvbiBoYW5kbGVyIGZvciBoYW5kbGluZyBzbGlkZXJzXG4gICAgZnVuY3Rpb24gU2xpZGVyKGNscykge1xuICAgICAgICB2YXIgY2xzID0gY2xzLFxuICAgICAgICAgICAgaXRlbUludGVydmFsID0gbnVsbCxcbiAgICAgICAgICAgICBzZWxmID0gdGhpcztcblxuICAgICAgICB0aGlzLmN1cnJlbnRJZHggPSBudWxsO1xuXG4gICAgICAgIHRoaXMuc3RvcEludGVydmFsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaXRlbUludGVydmFsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG1ha2luZyBjaGFuZ2VzIHRvIHRoZSBzbGlkZXJcbiAgICAgICAgdGhpcy5jaGFuZ2VTbGlkZXJJdGVtID0gZnVuY3Rpb24oY3VycmVudCwgaXRlbSwgY2xzKSB7XG4gICAgICAgICAgICBjdXJyZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xzKTtcbiAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChjbHMpO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50SWR4ID0gaXRlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuaW50ZXJ2YWxTbGlkZXJJdGVtID0gZnVuY3Rpb24oaXRlbXMsIGN1cnJlbnRJdGVtKSB7XG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRJZHggPSBjdXJyZW50SXRlbTtcbiAgICAgICAgICAgIHRoaXMuaXRlbUludGVydmFsID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGYuY3VycmVudElkeCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBpdGVtcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5jdXJyZW50SWR4ID09PSBpdGVtc1tpZHhdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpZHggLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggLSAxIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zLmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhbmdlU2xpZGVySXRlbShzZWxmLmN1cnJlbnRJZHgsIGl0ZW1zW2l0ZW1dLCBjbHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHNsaWRlQW5ub25jZU1haW4oKSB7XG4gICAgICAgIHZhciBwcmV2QnRuLFxuICAgICAgICAgICAgbmV4dEJ0bixcbiAgICAgICAgICAgIHNsaWRlckJ0bnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwic2xpZGVyLS1idG5cIiksXG4gICAgICAgICAgICBzbGlkZXJJdGVtcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJzbGlkZXItLWl0ZW1cIiksXG4gICAgICAgICAgICBzbGlkZXJIYW5kbGVyID0gbmV3IFNsaWRlcihcInNsaWRlci0taXRlbS1jdXJyZW50XCIpO1xuXG4gICAgICAgIGlmICghc2xpZGVyQnRucy5sZW5ndGggfHwgIXNsaWRlckl0ZW1zLmxlbmd0aCkgeyByZXR1cm47IH1cblxuICAgICAgICAvLyBoYW5kbGVyIGZvciBidG5zIGFuZCBzbGlkZXIgaXRlbXNcbiAgICAgICAgdmFyIGJ0bnNBY3Rpb24gPSB7XG4gICAgICAgICAgICBwcmV2aW91czogZnVuY3Rpb24oYnRuKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5leHRCdG4gJiYgbmV4dEJ0bi5kaXNhYmxlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICBuZXh0QnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgc2xpZGVySXRlbXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2xpZGVySXRlbXNbaWR4XS5jbGFzc0xpc3QuY29udGFpbnMoXCJzbGlkZXItLWl0ZW0tY3VycmVudFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCArIDEgPT09IHNsaWRlckl0ZW1zLmxlbmd0aCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidG4uZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpZHggKyAxO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXJIYW5kbGVyLmNoYW5nZVNsaWRlckl0ZW0oc2xpZGVySXRlbXNbaWR4XSwgc2xpZGVySXRlbXNbaXRlbV0sIFwic2xpZGVyLS1pdGVtLWN1cnJlbnRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBuZXh0OiBmdW5jdGlvbihidG4pIHtcbiAgICAgICAgICAgICAgICBpZiAocHJldkJ0biAmJiBwcmV2QnRuLmRpc2FibGVkID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHByZXZCdG4uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBzbGlkZXJJdGVtcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzbGlkZXJJdGVtc1tpZHhdLmNsYXNzTGlzdC5jb250YWlucyhcInNsaWRlci0taXRlbS1jdXJyZW50XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4IC0gMSA8IDAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9IFxuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGlkeCAtIDE7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlckhhbmRsZXIuY2hhbmdlU2xpZGVySXRlbShzbGlkZXJJdGVtc1tpZHhdLCBzbGlkZXJJdGVtc1tpdGVtXSwgXCJzbGlkZXItLWl0ZW0tY3VycmVudFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gZXZlbnQgbGlzdGVuZXIgaGFuZGxlciwgZGV0ZXJtaW5pbmcgdGhlIGJ0biBhbmQgY2FsbGluZyB0aGUgcmlnaHQgYWN0aW9uXG4gICAgICAgIGZ1bmN0aW9uIGJ0bnNIYW5kbGVyKGV2KSB7XG4gICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgIHNsaWRlckhhbmRsZXIuc3RvcEludGVydmFsKCk7XG5cbiAgICAgICAgICAgIHN3aXRjaCh0aGlzLm5hbWUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwicHJldmlvdXMtLWJ0blwiOlxuICAgICAgICAgICAgICAgICAgICBidG5zQWN0aW9uLnByZXZpb3VzKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBwcmV2QnRuID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIm5leHQtLWJ0blwiOlxuICAgICAgICAgICAgICAgICAgICBidG5zQWN0aW9uLm5leHQodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIG5leHRCdG4gPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gbG9vcHMgdG8gYWRkIGV2ZW50IGxpc3RlbmVycyB0byBidG5zIGFuZCBpdGVyYXRpbmcgb3ZlciBzbGlkZXIgaXRlbXNcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzbGlkZXJCdG5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBzbGlkZXJCdG5zW2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBidG5zSGFuZGxlcik7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBzbGlkZXJJdGVtcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICBpZiAoaWR4ID09PSBzbGlkZXJJdGVtcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgc2xpZGVySXRlbXNbaWR4XS5jbGFzc0xpc3QuYWRkKFwic2xpZGVyLS1pdGVtLWN1cnJlbnRcIik7XG4gICAgICAgICAgICAgICAgc2xpZGVySGFuZGxlci5pbnRlcnZhbFNsaWRlckl0ZW0oc2xpZGVySXRlbXMsIHNsaWRlckl0ZW1zW2lkeF0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gc2xpZGVBbm5vbmNlc0ZpZygpIHtcbiAgICAgICAgdmFyIHNsaWRlckhhbmRsZXIsXG4gICAgICAgICAgICBhbm5vbmNlc0NlbGxSZWYgPSB7fSxcbiAgICAgICAgICAgIGFubm9uY2VzQ2VsbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJhbm5vbmNlcy0tZ3JpZC1jZWxsXCIpO1xuXG4gICAgICAgIGlmICghYW5ub25jZXNDZWxsKSByZXR1cm47XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbm5vbmNlc0NlbGwubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBjZWxsQ2hpbGRyZW4gPSBhbm5vbmNlc0NlbGxbaV0uY2hpbGRyZW4sXG4gICAgICAgICAgICAgICAgY2VsbCA9IGFubm9uY2VzQ2VsbFtpXTtcbiAgICAgICAgICAgIGFubm9uY2VzQ2VsbFJlZltjZWxsXSA9IFtdO1xuXG4gICAgICAgICAgICBzbGlkZXJIYW5kbGVyID0gbmV3IFNsaWRlcihcImFubm9uY2VzLS1maWctY3VycmVudFwiKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaXggPSAwOyBpeCA8IGNlbGxDaGlsZHJlbi5sZW5ndGg7IGl4KyspIHtcblxuICAgICAgICAgICAgICAgIGlmIChjZWxsQ2hpbGRyZW5baXhdLnRhZ05hbWUgPT09IFwiRklHVVJFXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ub25jZXNDZWxsUmVmW2NlbGxdW2l4XSA9IGNlbGxDaGlsZHJlbi5pdGVtKGl4KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxDaGlsZHJlbi5pdGVtKGl4KS5jbGFzc0xpc3QuYWRkKFwiYW5ub25jZXMtLWZpZy1jdXJyZW50XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVySGFuZGxlci5pbnRlcnZhbFNsaWRlckl0ZW0oYW5ub25jZXNDZWxsUmVmW2NlbGxdLCBjZWxsQ2hpbGRyZW4uaXRlbShpeCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coc2xpZGVySGFuZGxlcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhbm5vbmNlR2FsbGVyeUhhbmRsZXIoKSB7XG4gICAgICAgIHZhciBnYWxsZXJ5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImFubm9uY2UtLWdhbGxlcnktd3JhcFwiKVswXSxcbiAgICAgICAgICAgIGNlbGxJdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImFubm9uY2UtLWl0ZW0tY2VsbFwiKVswXSxcbiAgICAgICAgICAgIGNlbGxJdGVtcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJhbm5vbmNlLS1pdGVtcy1jZWxsXCIpO1xuXG4gICAgICAgIGlmICghZ2FsbGVyeSkgcmV0dXJuO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2VsbEl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjZWxsSXRlbXNbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2KSB7XG4gICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgZmlnID0gdGhpcy5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBjZWxsSXRlbS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgY2VsbEl0ZW0uaW5uZXJIVE1MID0gZmlnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9IFxuXG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImRvY3VtZW50IHJlYWR5IVwiKTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIG5hdkhhbmRsZXIoKSB7XG4gICAgICAgIHZhciBoYW1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImhhbS0tYnV0dG9uXCIpLFxuICAgICAgICAgICAgbmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWluLS1uYXZcIik7XG5cbiAgICAgICAgaGFtQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihldikge1xuICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICBpZiAoIW5hdi5jbGFzc0xpc3QuY29udGFpbnMoXCJuYXYtLXNob3duXCIpKSB7XG4gICAgICAgICAgICAgICAgbmF2LmNsYXNzTGlzdC5hZGQoXCJuYXYtLXNob3duXCIpO1xuICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgbmF2LmNsYXNzTGlzdC5yZW1vdmUoXCJuYXYtLXNob3duXCIpO1xuICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0gXG5cbiAgICBkb2N1bWVudC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwiY29tcGxldGVcIikge1xuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICAgICAgbmF2SGFuZGxlcigpO1xuICAgICAgICAgICAgZm9ybXNIYW5kbGVyID0gbmV3IEZvcm1zSGFuZGxlcigpO1xuICAgICAgICAgICAgZm9ybXNIYW5kbGVyLmluaXQoKTsgICAgICAgICAgXG4gICAgICAgICAgICBzbGlkZUFubm9uY2VNYWluKCk7XG4gICAgICAgICAgICBzbGlkZUFubm9uY2VzRmlnKCk7XG4gICAgICAgICAgICBhbm5vbmNlR2FsbGVyeUhhbmRsZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxufSgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyByZXNvdXJjZXMvYXNzZXRzL2pzL2FwcC5qcyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=");

/***/ }
/******/ ]);